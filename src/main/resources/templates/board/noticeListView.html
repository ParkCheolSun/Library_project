<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
	layout:decorate="~{layouts/layoutForm}">
<head>
<meta charset="UTF-8">
<meta id="_csrf" name="_csrf" th:content="${_csrf.token}" />
<meta id="_csrf_header" name="_csrf_header"
	th:content="${_csrf.headerName}" />
<link rel="stylesheet" href="/css/lib/bootstrap.min.css">
<link th:href="@{/css/noticeForm.css}" rel="stylesheet">
</head>
<div id="notice-wrapper" layout:fragment="content">
	<div class="notice-container">
		<h1>공지사항</h1>
		<form action="/board/list" id="frm" method="get">
			<div class="col-md-12 mt-4">
				<span class="btn btn-danger" onclick="fnDelete()"
					sec:authorize="hasAnyAuthority('ROLE_MANAGER','ROLE_ADMIN')">삭제</span>
				<span class="btn btn-primary"
					onclick="javascript:location.href='/board/noticeWrite'" 
					sec:authorize="hasAnyAuthority('ROLE_MANAGER','ROLE_ADMIN')">작성</span>
				<table
					class="table table-striped table-horizontal table-bordered mt-3">
					<thead class="thead-strong">
						<tr>
							<th width="5%" sec:authorize="hasAnyAuthority('ROLE_MANAGER','ROLE_ADMIN')"><input type="checkbox" id="chkAll"></th>
							<th width="10%">번호</th>
							<th width="">제목</th>
							<th width="20%">작성자</th>
							<th width="10%">조회수</th>
							<th width="20%">작성일</th>
						</tr>
					</thead>
					<tbody id="tbody">
						<tr th:each="list,index : ${resultMap.list}"
							th:with="paging=${resultMap.paging}">
							<td sec:authorize="hasAnyAuthority('ROLE_MANAGER','ROLE_ADMIN')"><input type="checkbox" name="deleteId"
								th:value="${list.id}"></td>
							<td><span
								th:text="${(resultMap.totalCnt - index.index) - (paging.pageNumber * paging.pageSize)}"></span>
							</td>

							<td><a th:href="@{./noticeDetailView(id=${list.id})}"><span
									th:text="${list.title}"></span></a></td>
							<td><span th:text="${list.registerId}"></span></td>
							<td><span th:text="${list.readCnt}"></span></td>
							<td><span th:text="${list.registerTime}"></span></td>
						<tr>
					</tbody>
				</table>
				<div class="row">
					<div class="col">
						<ul class="pagination">
							<li class="page-item"
								th:each="index : ${#numbers.sequence(1, resultMap.totalPage)}"
								th:with="paging=${resultMap.paging}"><a class="page-link"
								th:classappend="${paging.pageNumber ==  (index-1)} ? bg-primary : bg-secondary"
								th:href="@{./notice(page=${index - 1},page=${paging.pageSize})}"
								th:if="${index != 0}">
									<span class="text-white" th:text="${index}"></span>
							</a></li>
						</ul>
					</div>
				</div>
			</div>
			<input type="hidden" th:name="${_csrf.parameterName}"
				th:value="${_csrf.token}">
		</form>
	</div>
</div>
<!--부트스트랩 js, jquery 추가-->
<script src="/javascript/lib/jquery.min.js"></script>
<script src="/javascript/lib/bootstrap.min.js"></script>
<script>
	// header checkbox event
	$("#chkAll").click(function() {
		if (this.checked) {
			$("input[name='deleteId']").prop("checked", true);
		} else {
			$("input[name='deleteId']").prop("checked", false);
		}
	});

	// body checkbox event
	$("input[name='deleteId']").click(function() {
		let delInpLen = $("input[name='deleteId']").length;
		let delInpChkLen = $("input[name='deleteId']:checked").length;

		if (delInpLen == delInpChkLen) {
			$("#chkAll").prop("checked", true);
		} else {
			$("#chkAll").prop("checked", false);
		}
	});

	function fnDelete() {
		let delInpChkLen = $("input[name='deleteId']:checked").length;

		if (delInpChkLen > 0) {
			if (confirm("삭제하시겠습니까?")) {
				let frm = $("#frm");
				frm.attr("action", "/board/delete");
				frm.attr("method", "post");
				frm.submit();
			}
		} else {
			alert("선택된 게시글이 없습니다.");
		}
	}
</script>
</html>